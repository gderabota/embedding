### README –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ `embedding`

---

## üöÄ –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö embeddings  
–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π —Ç–µ–∫—Å—Ç–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–æ–¥–µ–ª–∏ `LaBSE-en-ru`.  
**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—Ä–æ–µ–∫—Ç–µ:** [gderabota.ru](https://gderabota.ru)

---

## ‚öôÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
- **–ú–æ–¥–µ–ª—å:** `cointegrated/LaBSE-en-ru` (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—É—Å/–∞–Ω–≥–ª)
- **–§—Ä–µ–π–º–≤–æ—Ä–∫:** FastAPI
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** RotatingFileHandler (5 MB/—Ñ–∞–π–ª, 3 –±—ç–∫–∞–ø–∞)
- **–ü–æ—Ç–æ–∫–∏:** –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ 4 –ø–æ—Ç–æ–∫–∞ (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –ø—Ä–æ–¥–∞)

---

## üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
```bash
git clone https://github.com/gderabota/embedding.git
cd embedding
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```bash
pip install -r requirements.txt
```
*(–ü—Ä–∏–º–µ—Ä `requirements.txt`):*
```
fastapi
uvicorn[standard]
torch
transformers
logging
pydantic
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
```bash
uvicorn app:app --host 0.0.0.0 --port 8000 --workers 1
```
*–î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:*  
`--workers 4` + Nginx/Gunicorn (—Å–º. —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∏–∂–µ)

---

## üì° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API

### –≠–Ω–¥–ø–æ–∏–Ω—Ç
`POST /embedding`

### –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (JSON)
```json
{
  "text": "–í–∞—à —Ç–µ–∫—Å—Ç –¥–ª—è –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"
}
```

### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ (200 OK)
```json
{
  "embedding": [0.12, -0.05, ..., 0.87] // 768-–º–µ—Ä–Ω—ã–π –≤–µ–∫—Ç–æ—Ä
}
```

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤
#### cURL
```bash
curl -X POST "http://localhost:8000/embedding" \
-H "Content-Type: application/json" \
-d '{"text":"–ü—Ä–∏–≤–µ—Ç, –º–∏—Ä!"}'
```

#### Python
```python
import requests

response = requests.post(
    "http://localhost:8000/embedding",
    json={"text": "–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫?"}
)
print(response.json()["embedding"])
```

---

## ‚ö†Ô∏è –û—à–∏–±–∫–∏
| –ö–æ–¥ | –°—Ç–∞—Ç—É—Å                  | –ü—Ä–∏—á–∏–Ω–∞                     |
|-----|-------------------------|-----------------------------|
| 422 | Validation Error        | –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞     |
| 500 | Internal Server Error  | –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—Å—Ç–∞     |

---

## üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞
1. **–î–æ–∫–µ—Ä–∏–∑–∞—Ü–∏—è**  
   –ü—Ä–∏–º–µ—Ä `Dockerfile`:
   ```dockerfile
   FROM python:3.9-slim
   COPY . /app
   WORKDIR /app
   RUN pip install -r requirements.txt
   CMD ["uvicorn", "app:app", "--host", "0.0.0.0", "--port", "8000", "--workers", "4"]
   ```

2. **Nginx –∫–æ–Ω—Ñ–∏–≥**  
   –î–æ–±–∞–≤—å—Ç–µ –≤ `nginx.conf`:
   ```nginx
   location /embedding {
       proxy_pass http://localhost:8000;
       proxy_set_header Host $host;
   }
   ```

3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è GPU**  
   –ó–∞–º–µ–Ω–∏—Ç–µ `.to('cpu')` –Ω–∞ `.to('cuda')` –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ GPU.

---

## üìÑ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `./logs`:
```
app.log       # –¢–µ–∫—É—â–∏–π –ª–æ–≥
app.log.1     # –†–æ—Ç–∞—Ü–∏—è (–¥–æ 3 —Ñ–∞–π–ª–æ–≤)
```

---

## ‚öñÔ∏è –õ–∏—Ü–µ–Ω–∑–∏—è
–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç [–ª–∏—Ü–µ–Ω–∑–∏—é LaBSE](https://huggingface.co/cointegrated/LaBSE-en-ru) –º–æ–¥–µ–ª–∏.  
**–ö–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –≤–∞—à–∏–º –ø—Ä–æ–µ–∫—Ç–æ–º!

---

> **–í–∞–∂–Ω–æ!** –°–µ—Ä–≤–∏—Å —Ç—Ä–µ–±—É–µ—Ç ~1.5 –ì–ë RAM –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ.  
> –î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤: ceo@gderabota.ru
